"""–ú–æ–¥—É–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –ø–∞—Ä–æ–ª–µ–π."""

from .generator import generate_password
from .storage import save_password, find_password
from .utils import validate_password_length


def handle_generate(args):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª—è –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

    Args:
        args: –û–±—ä–µ–∫—Ç —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
            - length (int): –î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è
            - digits (bool): –í–∫–ª—é—á–∞—Ç—å —Ü–∏—Ñ—Ä—ã
            - special (bool): –í–∫–ª—é—á–∞—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
            - uppercase (bool): –í–∫–ª—é—á–∞—Ç—å –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
            - service (str): –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

    Raises:
        ValueError: –ï—Å–ª–∏ –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–π
    """
    try:
        validate_password_length(args.length)
    except ValueError as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
        return

    password = generate_password(
        length=args.length,
        use_digits=args.digits,
        use_special_chars=args.special,
        use_uppercase=args.uppercase
    )

    print(f"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å: {password}")

    # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Å–µ—Ä–≤–∏—Å, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–æ–ª—å
    if args.service:
        save_password(args.service, password)
        print(f"–ü–∞—Ä–æ–ª—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ '{args.service}' —Å–æ—Ö—Ä–∞–Ω—ë–Ω (–≤ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ).")


def handle_find(args):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –ø–æ–∏—Å–∫–∞ –ø–∞—Ä–æ–ª—è –ø–æ –∏–º–µ–Ω–∏ —Å–µ—Ä–≤–∏—Å–∞.

    Args:
        args: –û–±—ä–µ–∫—Ç —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
            - service (str): –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞

    Prints:
        –ù–∞–π–¥–µ–Ω–Ω—ã–π —Ö—ç—à –ø–∞—Ä–æ–ª—è –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    """
    hashed_pw = find_password(args.service)
    if hashed_pw:
        print(f"–ù–∞–π–¥–µ–Ω —Ö—ç—à –ø–∞—Ä–æ–ª—è –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ '{args.service}': {hashed_pw}")
        print("–í–ù–ò–ú–ê–ù–ò–ï: –ü–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
    else:
        print(f"–ü–∞—Ä–æ–ª—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ '{args.service}' –Ω–µ –Ω–∞–π–¥–µ–Ω.")


# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
def handle_list(args):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤—ã–≤–æ–¥–∞ –≤—Å–µ—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π."""
    from .storage import get_all_passwords

    passwords = get_all_passwords()

    if not passwords:
        print("–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π.")
        return

    print(f"\nüîê –ù–∞–π–¥–µ–Ω–æ {len(passwords)} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π:")
    print("=" * 50)
    for service, password_hash in passwords:
        print(f"üì± –°–µ—Ä–≤–∏—Å: {service}")
        print(f"üîí –•—ç—à –ø–∞—Ä–æ–ª—è: {password_hash}")
        print("-" * 50)


def handle_delete(args):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É —É–¥–∞–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è.

    Args:
        args: –û–±—ä–µ–∫—Ç —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
            - service (str): –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
    """
    from .storage import delete_password

    if delete_password(args.service):
        print(f"‚úÖ –ü–∞—Ä–æ–ª—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ '{args.service}' —É–¥–∞–ª–µ–Ω.")
    else:
        print(f"‚ùå –ü–∞—Ä–æ–ª—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ '{args.service}' –Ω–µ –Ω–∞–π–¥–µ–Ω.")


# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
def interactive_mode():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–∞—Ä–æ–ª–µ–π.

    –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–µ–Ω—é —Å –≤—ã–±–æ—Ä–æ–º –¥–µ–π—Å—Ç–≤–∏–π:
    - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
    - –ü–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
    - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    - –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    """
    print("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Ä–æ–ª–µ–π!")
    print("=" * 40)

    while True:
        print("\n–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?")
        print("1 - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å")
        print("2 - –ù–∞–π—Ç–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å")
        print("3 - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é")
        print("4 - –í—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã")

        choice = input("\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–π—Å—Ç–≤–∏—è (1/2/3/4): ").strip()

        if choice == "1":
            create_password_interactive()
        elif choice == "2":
            find_password_interactive()
        elif choice == "3":
            show_documentation_interactive()
        elif choice == "4":
            print("–î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
            break
        else:
            print("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")


def create_password_interactive():
    """–°–æ–∑–¥–∞–µ—Ç –ø–∞—Ä–æ–ª—å –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
    - –î–ª–∏–Ω—É –ø–∞—Ä–æ–ª—è
    - –ù–∞–ª–∏—á–∏–µ —Ü–∏—Ñ—Ä
    - –ù–∞–ª–∏—á–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
    - –ù–∞–ª–∏—á–∏–µ –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –±—É–∫–≤
    - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞
    """
    print("\n –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è")
    print("-" * 30)

    # –î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è
    while True:
        try:
            length = input("–í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –ø–∞—Ä–æ–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 12): ").strip()
            if not length:
                length = 12
                break
            length = int(length)
            validate_password_length(length)
            break
        except ValueError as e:
            print(f" {e}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")

    # –¶–∏—Ñ—Ä—ã
    digits = input("–î–æ–±–∞–≤–∏—Ç—å —Ü–∏—Ñ—Ä—ã? (–¥/–Ω, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥): ").strip().lower()
    use_digits = digits != '–Ω'

    # –°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
    special = input("–î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã? !@#$% (–¥/–Ω, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥): ").strip().lower()
    use_special = special != '–Ω'

    # –ó–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
    uppercase = input("–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã? (–¥/–Ω, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥): ").strip().lower()
    use_uppercase = uppercase != '–Ω'

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
    print("\n –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å...")
    password = generate_password(
        length=length,
        use_digits=use_digits,
        use_special_chars=use_special,
        use_uppercase=use_uppercase
    )

    print(f"‚úÖ –í–∞—à –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å: {password}")

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    save = input("\n–•–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞? (–¥/–Ω): ").strip().lower()
    if save == '–¥':
        service = input("–î–ª—è –∫–∞–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–æ–ª—å? (–Ω–∞–ø—Ä–∏–º–µ—Ä: gmail, yandex): ").strip()
        if service:
            save_password(service, password)
            print(f"‚úÖ –ü–∞—Ä–æ–ª—å –¥–ª—è '{service}' —Å–æ—Ö—Ä–∞–Ω—ë–Ω (–≤ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ)")
        else:
            print("–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")


def find_password_interactive():
    """–ò—â–µ—Ç –ø–∞—Ä–æ–ª—å –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Å–µ—Ä–≤–∏—Å–∞."""
    print("\n –ü–æ–∏—Å–∫ –ø–∞—Ä–æ–ª—è")
    print("-" * 20)

    service = input("–î–ª—è –∫–∞–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏—â–µ–º –ø–∞—Ä–æ–ª—å? ").strip()
    if not service:
        print("–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
        return

    hashed_pw = find_password(service)
    if hashed_pw:
        print(f"‚úÖ –ù–∞–π–¥–µ–Ω —Ö—ç—à –ø–∞—Ä–æ–ª—è –¥–ª—è '{service}': {hashed_pw}")
        print("–í–ù–ò–ú–ê–ù–ò–ï: –ü–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
    else:
        print(f"–ü–∞—Ä–æ–ª—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ '{service}' –Ω–µ –Ω–∞–π–¥–µ–Ω")


def show_documentation_interactive():
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –º–æ–¥—É–ª—è–º –∏ —Ñ—É–Ω–∫—Ü–∏—è–º –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ."""
    print("\n–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø –ì–ï–ù–ï–†–ê–¢–û–†–ê –ü–ê–†–û–õ–ï–ô")
    print("=" * 50)

    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑ __init__.py (–º–æ–¥—É–ª—è –≤ —Ü–µ–ª–æ–º)
    print("\n –û –ü–†–û–ï–ö–¢–ï PASSGEN:")
    print("-" * 25)
    try:
        import passgen
        if passgen.__doc__:
            print(passgen.__doc__)
        else:
            print("–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")
    except ImportError:
        print("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –º–æ–¥—É–ª—è")

    print("\n –§–£–ù–ö–¶–ò–Ø generate_password:")
    print("-" * 30)
    from .generator import generate_password
    if generate_password.__doc__:
        print(generate_password.__doc__)
    else:
        print("–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")

    print("\n –§–£–ù–ö–¶–ò–Ø save_password:")
    print("-" * 25)
    from .storage import save_password
    if save_password.__doc__:
        print(save_password.__doc__)
    else:
        print("–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")

    print("\n –§–£–ù–ö–¶–ò–Ø find_password:")
    print("-" * 25)
    from .storage import find_password
    if find_password.__doc__:
        print(find_password.__doc__)
    else:
        print("–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")

    print("\n –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:")
    print("-" * 25)
    print("‚Ä¢ generate_password(length=12) - –ø–∞—Ä–æ–ª—å –∏–∑ 12 —Å–∏–º–≤–æ–ª–æ–≤")
    print("‚Ä¢ generate_password(length=8, use_digits=False) - –±–µ–∑ —Ü–∏—Ñ—Ä")
    print("‚Ä¢ save_password('gmail', '–ø–∞—Ä–æ–ª—å') - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å")
    print("‚Ä¢ find_password('gmail') - –Ω–∞–π—Ç–∏ —Ö—ç—à –ø–∞—Ä–æ–ª—è")

    input("\n–ù–∞–∂–º–∏—Ç–µ Enter —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å...")
